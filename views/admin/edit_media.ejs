<%- include('./includes/head.ejs') %>

<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <%- include('./includes/header.ejs') %>

  <%- include('./includes/sidebar.ejs') %>
  
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        Медиа
        <small>Панель управления</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="/@admin/home"><i class="fa fa-dashboard"></i> Главная страница</a></li>
        <li><a href="/@admin/media">Медиа</a></li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
      <!-- Small boxes (Stat box) -->
      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <!-- /.box-header -->
             <section class="content">
      <div class="container-fluid">
        <form id="itemForm" action="<%= item.id %>?_method=PUT" method="POST" enctype="multipart/form-data">
          <div class="card card-primary">
            <div class="card-header">
              <h3 class="card-title">Content Details</h3>
            </div>
            <div class="card-body">

              <!-- Title -->
              <div class="form-group">
                <label for="title">Title</label>
                <input type="text" class="form-control" id="title" name="title" value="<%= item.title %>" required>
              </div>

              <!-- File Type -->
              <div class="form-group">
                <label for="file_type">File Type</label>
                <input type="text" readonly class="form-control" id="file_type" name="file_type" value="<%= item.file_type %>">
              </div>

              <!-- Video URL -->
              <div class="form-group" id="videoField" style="<%= item.file_type === 'video' ? '' : 'display:none;' %>">
                <label for="video_url">YouTube Video URL</label>
                <input type="text" class="form-control" id="video_url" name="video_url" value="<%= item.video_url %>">
              </div>

              <!-- Document Upload -->
              <div class="form-group" id="docField" style="<%= item.file_type === 'document' ? '' : 'display:none;' %>">
                <label for="file_path">Upload Document</label>
                <input type="file" class="form-control" id="file_path" name="doc">
                <% if(item.file_path) { %>
                  <small>Current file: <%= item.file_path %></small>
                <% } %>
              </div>

              <!-- Image input always visible -->
               <div class="form-group" id="docField">
                  <label for="image">Изображение</label>
                  <input type="file" name="image" id="image">
                  <% if(item.image_url) { %>
                    <small>Current file: <%= item.image_url %></small>
                  <% } %>                
                </div>
              

              <!-- Content Preview -->
              <div class="form-group mt-4">
                <label>Content Preview</label>
                <% if (item.file_type === 'video' && item.video_url) { %>
                  <div class="embed-responsive embed-responsive-16by9" style=" margin:auto;">
                    <% if (item.video_url && item.video_url.includes('v=')) { %>
                      <div class="embed-responsive embed-responsive-16by9" style="margin:auto;">
                        <iframe 
                          class="embed-responsive-item"
                          src="https://www.youtube.com/embed/<%= item.video_url.split('v=')[1].split('&')[0] %>"
                          allowfullscreen>
                        </iframe>
                      </div>
                    <% } %>

                  </div>
                <% } else if (item.file_type === 'document' && item.file_path) { %>
                  <iframe src="/uploads/docs/<%= item.file_path %>" 
                          style="width:700px; height:400px; display:block; margin:auto;" 
                          frameborder="0"></iframe>
                <% } else { %>
                  <p>No content available</p>
                <% } %>

              </div>
              <!-- Meta Information -->
                <div class="container">
                  <p><strong>Created at:</strong> <%= item.created_at %></p>
                  <p><strong>Last Updated:</strong> <%= item.updated_at %></p>
                </div>

            </div>

            <div class="box-footer">
                <div class="card-footer pull-right">
                  <a class="btn btn-info" href="/@admin/media">Back</a>
                  <button 
                    type="button"
                    class="btn btn-danger btn-delete"
                    data-toggle="modal"
                    data-target="#modal-delete"
                    data-id="<%= item.id %>"
                  >
                    Delete
                  </button>
                  <button type="submit" class="btn btn-success">Save Changes</button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </section>
        </div>
      </div>

    </section>
    <!-- /.content -->
  </div>

  <%- include('./includes/footer.ejs') %>

  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>


  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->


  <!-- Delete modal -->
  <div class="modal fade" id="modal-delete">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-red">
          <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
          <h4 class="modal-title">Подтвердите удаление</h4>
        </div>

        <form id="deleteForm" action="" method="POST">
          <input type="hidden" name="_method" value="DELETE">
          <div class="modal-body">
            <p>
              Вы уверены, что хотите удалить этот документ?
              <br>
              <strong id="deleteName"></strong>
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Отменить</button>
            <button type="submit" class="btn btn-danger">Удалить</button>
          </div>
        </form>

      </div>
    </div>
  </div>

  <script>
    $('.btn-delete').on('click', function () {
      const id = $(this).data('id');
      const name = $(this).data('name');
      const pathname = window.location.pathname;
      const deleteUrl = pathname.replace('/edit', '/delete'); 
      // console.log('Current pathname:', deleteUrl);

      // Set confirm text
      $('#deleteName').text(name);

      // Point the form to the resource
      $('#deleteForm').attr('action', deleteUrl);
    });

    // Optional safety: clear action when modal hides
    $('#modal-delete').on('hidden.bs.modal', function () {
      $('#deleteForm').attr('action', '');
      $('#deleteName').text('');
    });
  </script> 

<%- include('./includes/end.ejs') %>
</body>
</html>
